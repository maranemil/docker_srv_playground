<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CRUD App</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
  <div class="container mt-5">
    <h1 class="text-center">CRUD App with SQLite</h1>
    <form id="itemForm" class="mb-3">
      <div class="row">
        <div class="col-md-5">
          <input type="text" id="name" class="form-control" placeholder="Item Name" required>
        </div>
        <div class="col-md-3">
          <input type="number" id="quantity" class="form-control" placeholder="Quantity" required>
        </div>
        <div class="col-md-4">
          <button type="submit" class="btn btn-primary w-100">Add Item</button>
        </div>
      </div>
    </form>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Quantity</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="itemsTable"></tbody>
    </table>
  </div>

  <script>
    const apiUrl = '/api/items';

    // Fetch and display items
    function fetchItems() {
      fetch(apiUrl)
        .then(res => res.json())
        .then(data => {
          const table = document.getElementById('itemsTable');
          table.innerHTML = '';
          data.forEach(item => {
            table.innerHTML += `
              <tr>
                <td>${item.id}</td>
                <td>${item.name}</td>
                <td>${item.quantity}</td>
                <td>
                  <button class="btn btn-warning btn-sm" onclick="editItem(${item.id}, '${item.name}', ${item.quantity})">Edit</button>
                  <button class="btn btn-danger btn-sm" onclick="deleteItem(${item.id})">Delete</button>
                </td>
              </tr>
            `;
          });
        });
    }

    // Add new item
    document.getElementById('itemForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const name = document.getElementById('name').value;
      const quantity = document.getElementById('quantity').value;

      fetch(apiUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, quantity })
      }).then(() => {
        fetchItems();
        this.reset();
      });
    });

    // Edit item
    function editItem(id, name, quantity) {
      const newName = prompt('Enter new name:', name);
      const newQuantity = prompt('Enter new quantity:', quantity);

      if (newName && newQuantity) {
        fetch(`${apiUrl}/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name: newName, quantity: parseInt(newQuantity) })
        }).then(() => fetchItems());
      }
    }

    // Delete item
    function deleteItem(id) {
      if (confirm('Are you sure you want to delete this item?')) {
        fetch(`${apiUrl}/${id}`, { method: 'DELETE' }).then(() => fetchItems());
      }
    }

    // Initial fetch
    fetchItems();
  </script>
</body>
</html>